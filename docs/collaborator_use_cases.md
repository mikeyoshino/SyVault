# Use Case: Collaborator System

## สถานการณ์ตัวอย่าง

### 👨‍👩‍👧‍👦 ครอบครัวคุณสมชาย

**เจ้าของ Account:** คุณสมชาย (Owner)
- มี Account: "Family Vault - ครอบครัวใจดี"
- เก็บเอกสารครอบครัว 5 คน:
  - คุณสมชาย (ตัวเอง)
  - คุณสมหญิง (ภรรยา)
  - น้องแพม (ลูกสาว)
  - น้องโอ๊ต (ลูกชาย)
  - คุณแม่สุดา (แม่)

---

## Use Case 1: เชิญภรรยาเป็น Admin

### 📋 สถานการณ์
คุณสมชายต้องการให้ภรรยา (คุณสมหญิง) ช่วยจัดการเอกสารครอบครัวได้เต็มที่

### 🔄 ขั้นตอน

#### 1. คุณสมชาย (Owner) เชิญ Collaborator

```
┌─────────────────────────────────────────┐
│ Family Vault - ครอบครัวใจดี             │
├─────────────────────────────────────────┤
│ 👥 Collaborators (1)                    │
│                                         │
│ ┌─────────────────────────────────────┐ │
│ │ คุณสมชาย (You) - Owner              │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ [+ เชิญผู้ร่วมงาน]                      │
└─────────────────────────────────────────┘
```

**กดปุ่ม "เชิญผู้ร่วมงาน":**

```
┌─────────────────────────────────────────┐
│ เชิญผู้ร่วมจัดการ Account                │
├─────────────────────────────────────────┤
│                                         │
│ อีเมล:                                  │
│ [somying@email.com            ]         │
│                                         │
│ สิทธิ์การเข้าถึง:                       │
│ ○ Viewer   (ดูอย่างเดียว)               │
│ ○ Editor   (ดู + แก้ไข)                 │
│ ● Admin    (ทำได้ทุกอย่าง)              │
│                                         │
│ [ยกเลิก]  [ส่งคำเชิญ]                   │
└─────────────────────────────────────────┘
```

**ระบบทำงาน (Backend):**
1. ตรวจสอบว่า `somying@email.com` มี Account ในระบบหรือไม่
2. ดึง Public Key ของคุณสมหญิง
3. คุณสมชาย encrypt Master Key ด้วย Public Key ของคุณสมหญิง
4. บันทึกลง `AccountCollaborators` table
5. ส่งอีเมลแจ้งเตือนไปหาคุณสมหญิง

#### 2. คุณสมหญิง รับคำเชิญ

**Email ที่ได้รับ:**
```
From: DigitalVault <noreply@digitalvault.com>
To: somying@email.com
Subject: คุณสมชาย เชิญคุณเข้าร่วม "Family Vault - ครอบครัวใจดี"

สวัสดีค่ะ คุณสมหญิง

คุณสมชาย ได้เชิญคุณเข้าร่วมจัดการ Account "Family Vault - ครอบครัวใจดี"
ในฐานะ: Admin (สิทธิ์เต็ม)

[ยอมรับคำเชิญ]  [ปฏิเสธ]
```

**คุณสมหญิง Login และเห็น:**

```
┌─────────────────────────────────────────┐
│ คำเชิญที่รอดำเนินการ (1)                 │
├─────────────────────────────────────────┤
│ 🏠 Family Vault - ครอบครัวใจดี          │
│    เชิญโดย: คุณสมชาย                    │
│    สิทธิ์: Admin                        │
│    [ยอมรับ]  [ปฏิเสธ]                   │
└─────────────────────────────────────────┘
```

**กด "ยอมรับ":**
- ระบบ decrypt Master Key ด้วย Private Key ของคุณสมหญิง
- เก็บ Master Key ไว้ใน memory
- Account "Family Vault" ปรากฏในรายการ Accounts ของคุณสมหญิง

#### 3. คุณสมหญิง เข้าถึง Account

**หน้า Select Vault ของคุณสมหญิง:**

```
┌─────────────────────────────────────────┐
│ เลือก Vault                             │
├─────────────────────────────────────────┤
│ 🏠 My Personal Vault (Owner)            │
│ 👨‍👩‍👧‍👦 Family Vault - ครอบครัวใจดี (Admin) │
│ ➕ สร้าง Vault ใหม่                     │
└─────────────────────────────────────────┘
```

**เลือก "Family Vault - ครอบครัวใจดี":**

### ✅ สิ่งที่คุณสมหญิง (Admin) ทำได้:

#### ✅ ดูข้อมูลทั้งหมด
- ดูรายชื่อสมาชิกครอบครัวทั้ง 5 คน
- ดูเอกสารทุกประเภท (บัตรประชาชน, ใบขับขี่, พาสปอร์ต, ฯลฯ)
- ดาวน์โหลดเอกสาร
- ดูบันทึกต่างๆ

#### ✅ แก้ไขข้อมูล
- เพิ่มสมาชิกครอบครัวใหม่
- แก้ไขข้อมูลสมาชิก (ชื่อ, เบอร์โทร, ฯลฯ)
- อัพโหลดเอกสารใหม่
- แก้ไขข้อมูลเอกสาร (เลขบัตร, วันหมดอายุ)
- เพิ่ม/แก้ไข บันทึก

#### ✅ ลบข้อมูล
- ลบสมาชิกครอบครัว
- ลบเอกสาร
- ลบบันทึก

#### ✅ เชิญคนอื่น (Admin เท่านั้น)
- เชิญ Collaborator คนอื่นเข้ามา
- ตัวอย่าง: เชิญน้องแพม (ลูกสาว) เป็น Editor

#### ✅ จัดการสิทธิ์ (Admin เท่านั้น)
- เปลี่ยนสิทธิ์ Collaborator คนอื่น
- ลบ Collaborator ออกจาก Account

---

## Use Case 2: เชิญลูกสาวเป็น Editor

### 📋 สถานการณ์
คุณสมหญิงต้องการให้น้องแพม (ลูกสาว อายุ 25 ปี) ช่วยอัพเดทข้อมูลเอกสาร แต่ไม่ต้องการให้เชิญคนอื่นได้

### 🔄 ขั้นตอน

คุณสมหญิง (Admin) เชิญน้องแพม:

```
อีเมล: pam@email.com
สิทธิ์: Editor
```

### ✅ สิ่งที่น้องแพม (Editor) ทำได้:

#### ✅ ดูข้อมูลทั้งหมด
- ดูรายชื่อสมาชิกครอบครัว
- ดูเอกสารทุกประเภท
- ดาวน์โหลดเอกสาร

#### ✅ แก้ไขข้อมูล
- เพิ่มสมาชิกครอบครัวใหม่
- แก้ไขข้อมูลสมาชิก
- อัพโหลดเอกสารใหม่
- แก้ไขข้อมูลเอกสาร

#### ✅ ลบข้อมูล
- ลบสมาชิกครอบครัว
- ลบเอกสาร

#### ❌ ไม่สามารถทำได้:
- ❌ เชิญ Collaborator คนอื่น
- ❌ เปลี่ยนสิทธิ์ Collaborator
- ❌ ลบ Collaborator ออก
- ❌ ลบ Account

---

## Use Case 3: เชิญลูกชายเป็น Viewer

### 📋 สถานการณ์
คุณสมชายต้องการให้น้องโอ๊ต (ลูกชาย อายุ 18 ปี) ดูข้อมูลเอกสารครอบครัวได้ แต่ยังไม่ให้แก้ไข

### 🔄 ขั้นตอน

คุณสมชาย (Owner) เชิญน้องโอ๊ต:

```
อีเมล: oat@email.com
สิทธิ์: Viewer
```

### ✅ สิ่งที่น้องโอ๊ต (Viewer) ทำได้:

#### ✅ ดูข้อมูลเท่านั้น
- ดูรายชื่อสมาชิกครอบครัว
- ดูเอกสารทุกประเภท
- ดาวน์โหลดเอกสาร (read-only)
- ดูบันทึก

#### ❌ ไม่สามารถทำได้:
- ❌ เพิ่มสมาชิกครอบครัว
- ❌ แก้ไขข้อมูลสมาชิก
- ❌ อัพโหลดเอกสาร
- ❌ แก้ไขเอกสาร
- ❌ ลบข้อมูลใดๆ
- ❌ เชิญคนอื่น
- ❌ จัดการสิทธิ์

---

## สรุปสิทธิ์การเข้าถึง

### 📊 ตารางเปรียบเทียบ

| การกระทำ | Owner | Admin | Editor | Viewer |
|----------|-------|-------|--------|--------|
| **ดูข้อมูล** |
| ดูสมาชิกครอบครัว | ✅ | ✅ | ✅ | ✅ |
| ดูเอกสาร | ✅ | ✅ | ✅ | ✅ |
| ดาวน์โหลดเอกสาร | ✅ | ✅ | ✅ | ✅ |
| **แก้ไขข้อมูล** |
| เพิ่มสมาชิกครอบครัว | ✅ | ✅ | ✅ | ❌ |
| แก้ไขข้อมูลสมาชิก | ✅ | ✅ | ✅ | ❌ |
| อัพโหลดเอกสาร | ✅ | ✅ | ✅ | ❌ |
| แก้ไขเอกสาร | ✅ | ✅ | ✅ | ❌ |
| เพิ่ม/แก้ไข บันทึก | ✅ | ✅ | ✅ | ❌ |
| **ลบข้อมูล** |
| ลบสมาชิกครอบครัว | ✅ | ✅ | ✅ | ❌ |
| ลบเอกสาร | ✅ | ✅ | ✅ | ❌ |
| ลบบันทึก | ✅ | ✅ | ✅ | ❌ |
| **จัดการ Collaborators** |
| เชิญ Collaborator | ✅ | ✅ | ❌ | ❌ |
| เปลี่ยนสิทธิ์ Collaborator | ✅ | ✅ | ❌ | ❌ |
| ลบ Collaborator | ✅ | ✅ | ❌ | ❌ |
| **จัดการ Account** |
| เปลี่ยนชื่อ Account | ✅ | ✅ | ❌ | ❌ |
| ลบ Account | ✅ | ❌ | ❌ | ❌ |

---

## UI ตัวอย่าง

### หน้า Collaborators Management (สำหรับ Owner/Admin)

```
┌─────────────────────────────────────────────────────────┐
│ Family Vault - ครอบครัวใจดี                             │
├─────────────────────────────────────────────────────────┤
│ 👥 ผู้ร่วมจัดการ (4 คน)                                 │
│                                                         │
│ ┌───────────────────────────────────────────────────┐   │
│ │ 👤 คุณสมชาย (You)                                 │   │
│ │    Owner · เข้าถึงล่าสุด: เมื่อสักครู่              │   │
│ └───────────────────────────────────────────────────┘   │
│                                                         │
│ ┌───────────────────────────────────────────────────┐   │
│ │ 👤 คุณสมหญิง                                      │   │
│ │    Admin · เข้าถึงล่าสุด: 2 ชม. ที่แล้ว            │   │
│ │    [เปลี่ยนเป็น Editor ▼] [ลบออก]                 │   │
│ └───────────────────────────────────────────────────┘   │
│                                                         │
│ ┌───────────────────────────────────────────────────┐   │
│ │ 👤 น้องแพม                                        │   │
│ │    Editor · เข้าถึงล่าสุด: เมื่อวาน               │   │
│ │    [เปลี่ยนเป็น Admin ▼] [ลบออก]                  │   │
│ └───────────────────────────────────────────────────┘   │
│                                                         │
│ ┌───────────────────────────────────────────────────┐   │
│ │ 👤 น้องโอ๊ต                                       │   │
│ │    Viewer · เข้าถึงล่าสุด: 3 วันที่แล้ว           │   │
│ │    [เปลี่ยนเป็น Editor ▼] [ลบออก]                 │   │
│ └───────────────────────────────────────────────────┘   │
│                                                         │
│ [+ เชิญผู้ร่วมงาน]                                      │
└─────────────────────────────────────────────────────────┘
```

### หน้า Family Members (แสดงสิทธิ์)

```
┌─────────────────────────────────────────────────────────┐
│ สมาชิกครอบครัว (5 คน)                                   │
│                                                         │
│ คุณกำลังดูในฐานะ: Editor                                │
│ คุณสามารถ: ดู, แก้ไข, ลบ (ไม่สามารถเชิญคนอื่นได้)      │
├─────────────────────────────────────────────────────────┤
│                                                         │
│ [+ เพิ่มสมาชิกครอบครัว] ✅ (Editor สามารถทำได้)         │
│                                                         │
│ ┌───────────────────────────────────────────────────┐   │
│ │ 👤 คุณสมชาย                                       │   │
│ │    พ่อ · บัตรประชาชน, ใบขับขี่                    │   │
│ │    [ดูรายละเอียด] [แก้ไข] [ลบ]                    │   │
│ └───────────────────────────────────────────────────┘   │
│                                                         │
│ ...                                                     │
└─────────────────────────────────────────────────────────┘
```

---

## Audit Log ตัวอย่าง

```
┌─────────────────────────────────────────────────────────┐
│ บันทึกการใช้งาน - Family Vault                          │
├─────────────────────────────────────────────────────────┤
│ 🕐 วันนี้ 14:30 - คุณสมหญิง (Admin)                     │
│    📄 อัพโหลดเอกสาร "พาสปอร์ตน้องแพม"                   │
│                                                         │
│ 🕐 วันนี้ 10:15 - น้องแพม (Editor)                      │
│    ✏️ แก้ไขข้อมูล "คุณแม่สุดา" - อัพเดทเบอร์โทร        │
│                                                         │
│ 🕐 เมื่อวาน 16:45 - คุณสมชาย (Owner)                    │
│    👥 เชิญ "น้องโอ๊ต" เป็น Viewer                        │
│                                                         │
│ 🕐 เมื่อวาน 09:20 - น้องโอ๊ต (Viewer)                   │
│    👁️ ดูเอกสาร "บัตรประชาชนคุณสมชาย"                    │
└─────────────────────────────────────────────────────────┘
```

---

## ข้อควรระวัง

### 🔒 Security

1. **Master Key Sharing:**
   - Master Key ถูกเข้ารหัสด้วย Public Key ของแต่ละ Collaborator
   - แต่ละคนมี Private Key ของตัวเอง
   - ถ้า Collaborator ถูกลบออก ก็ไม่สามารถเข้าถึงข้อมูลใหม่ได้

2. **Revoke Access:**
   - Owner/Admin สามารถลบ Collaborator ได้ทันที
   - ระบบจะอัพเดท `IsActive = false` และ `RevokedAt`
   - Collaborator จะไม่สามารถเข้าถึง Account ได้อีก

3. **Audit Trail:**
   - ทุกการกระทำถูกบันทึกใน `AuditLogs`
   - Owner สามารถดูว่าใครทำอะไรเมื่อไหร่

### ⚠️ Limitations

1. **Collaborator ไม่สามารถ:**
   - ถ่ายโอน Ownership
   - ลบ Owner ออกจาก Account
   - เปลี่ยนสิทธิ์ของตัวเอง

2. **Owner เท่านั้นที่:**
   - ลบ Account ได้
   - เปลี่ยน Master Key ได้ (re-encryption)
